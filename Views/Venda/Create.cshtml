@model Models.Venda
@{
    ViewData["Title"] = "Nova Venda";
}

<h1>Nova Venda</h1>

<div class="row">
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Formulário de Venda</h5>
            </div>
            <div class="card-body">
                <form asp-action="Create">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    
                    <div class="mb-3">
                        <label asp-for="idCliente" class="form-label">Cliente</label>
                        <select asp-for="idCliente" class="form-select" asp-items="ViewBag.Clientes">
                            <option value="">Selecione um cliente</option>
                        </select>
                        <span asp-validation-for="idCliente" class="text-danger"></span>
                    </div>
                    
                    <div class="mb-3">
                        <label asp-for="idProduto" class="form-label">Produto</label>
                        <select asp-for="idProduto" class="form-select" asp-items="ViewBag.Produtos">
                            <option value="">Selecione um produto</option>
                        </select>
                        <span asp-validation-for="idProduto" class="text-danger"></span>
                    </div>
                    
                    <div class="mb-3">
                        <label asp-for="qtdVenda" class="form-label">Quantidade</label>
                        <input asp-for="qtdVenda" class="form-control" type="number" min="1" id="qtdVenda" required />
                        <span asp-validation-for="qtdVenda" class="text-danger"></span>
                    </div>
                    
                    <div class="mb-3">
                        <label asp-for="vlrUnitarioVenda" class="form-label">Valor Unitário</label>
                        <input asp-for="vlrUnitarioVenda" class="form-control" type="number" step="0.01" min="0.01" id="vlrUnitario" required />
                        <span asp-validation-for="vlrUnitarioVenda" class="text-danger"></span>
                    </div>
                    
                    <div class="mb-3">
                        <label asp-for="dthVenda" class="form-label">Data da Venda</label>
                        <input asp-for="dthVenda" class="form-control" type="datetime-local" required />
                        <span asp-validation-for="dthVenda" class="text-danger"></span>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Valor Total (calculado)</label>
                        <input type="text" id="vlrTotal" class="form-control" readonly />
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a asp-action="Index" class="btn btn-outline-secondary">Cancelar</a>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        $(document).ready(function() {
            // Função para calcular o valor total
            function calcularTotal() {
                var quantidade = $("#qtdVenda").val();
                var valorUnitario = $("#vlrUnitario").val();
                var valorTotal = quantidade * valorUnitario;
                $("#vlrTotal").val(valorTotal.toFixed(2));
            }
            
            // Atualizar valor total quando quantidade ou valor unitário mudar
            $("#qtdVenda, #vlrUnitario").change(calcularTotal);
            
            // Calcular o total inicial
            calcularTotal();
        });
    </script>
}